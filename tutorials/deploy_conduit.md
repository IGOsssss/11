<md-hidden>
üõë –î–∞–Ω–Ω—ã–π —Ç—É—Ç–æ—Ä–∏–∞–ª –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ GitHub üî¥ –Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! –≠—Ç–æ –ª–∏—à—å –∏—Å—Ö–æ–¥–Ω–∏–∫.<br>
–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è https://www.epic1h.com/deploy_conduit
</md-hidden>

# –¢—É—Ç–æ—Ä–∏–∞–ª: –¥–µ–ø–ª–æ–∏–º –ø—Ä–æ–µ–∫—Ç –Ω–∞ —Å–≤–æ–µ–º —Å–µ—Ä–≤–µ—Ä–µ

–ü–æ–¥–æ–π–¥–µ—Ç —Ç–µ–º, –∫—Ç–æ —Ö–æ—á–µ—Ç –Ω–∞—É—á–∏—Ç—Å—è –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—è Docker –Ω–∞ —Å–≤–æ–µ–º —Å–µ—Ä–≤–µ—Ä–µ.

#Docker #DockerSwarm #DockerHub #DockerCompose #Postgres

# üëç –ß—Ç–æ —Å–¥–µ–ª–∞–µ–º

* –°–æ–±–µ—Ä–µ–º –∏ –∑–∞–ø—É—Å—Ç–∏–º –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ–µ–∫—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –±–ª–æ–≥–æ–≤ –Ω–∞ Docker Swarm.
* –ù–∞—É—á–∏–º—Å—è –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ–±—Ä–∞–∑ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Docker Hub —Å –Ω—É–∂–Ω—ã–º —Ç–µ–≥–æ–º.
* –ù–∞—Å—Ç—Ä–æ–∏–º —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä —É —Ö–æ—Å—Ç–∏–Ω–≥ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —á–µ—Ä–µ–∑ SSH.
* –†–∞–∑–≤–µ—Ä–Ω–µ–º –ø—Ä–æ–µ–∫—Ç –Ω–∞ –≤–Ω–µ—à–Ω–µ–º IP –∞–¥—Ä–µ—Å–µ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç.

# üòç –ñ–∏–≤–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

<import from="/partials/zoom_standups.md"></import>

# üí™ –ú–∏–Ω—É—Ç–∫–∞ –º–æ—Ç–∏–≤–∞—Ü–∏–∏

–°–≤–æ–π —Å–µ—Ä–≤–µ—Ä –∑–≤—É—á–∏—Ç –∫—Ä—É—Ç–æ! –°–∫–æ—Ä–æ —É —Ç–µ–±—è –±—É–¥–µ—Ç —Å–≤–æ—è –ø—Ä–µ–ª–µ—Å—Ç—å ü§£

<iframe src="https://giphy.com/embed/JQxvzmyA3bo3e" 
    width="480" height="347" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>

***

# üî¢ –®–∞–≥–∏

## +1. –§–æ—Ä–∫–∞–µ–º Conduit

**A.** –ï—Å–ª–∏ —Ç—ã –ø—Ä–æ—Ö–æ–¥–∏–ª —Ç—É—Ç–æ—Ä–∏–∞–ª—ã:

* [–°–æ–±–∏—Ä–∞–µ–º Conduit –ª–æ–∫–∞–ª—å–Ω–æ](https://www.epic1h.com/build_conduit)
* [–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ CI/CD](https://www.epic1h.com/cypress_cicd)

- [x] –û—Ç–∫—Ä–æ–π –º–∞–º–∞ –ø—Ä–æ–µ–∫—Ç –≤ VS Code.

**B.** –ï—Å–ª–∏ –Ω–µ—Ç:

- [x] –°–¥–µ–ª–∞–π —Ñ–æ—Ä–∫ —Ä–µ–ø–æ–∑–∏—Ç–∞—Ä–∏—è [TonyMckes/conduit-realworld-example-app](https://github.com/TonyMckes/conduit-realworld-example-app)
- [x] –ö–ª–æ–Ω–∏—Ä—É–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä.
- [x] –û—Ç–∫—Ä–æ–π –ø—Ä–æ–µ–∫—Ç –≤ VS Code.

***

‚ùì –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Fork –≤ Git?

```markdown quiz fork_in_git_why
- [ ] –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- [ ] –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ç–æ–∫ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- [x] –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π –∫–æ–ø–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ GitHub
- [ ] –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –≤–µ—Ç–∫–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Git
```

‚ùì –ö–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è Fork –≤ Git?

```markdown quiz fork_git_then
- [x] –°–æ–∑–¥–∞—Ç—å Pull Request –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [ ] –£–¥–∞–ª–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [ ] –û–±—ä–µ–¥–∏–Ω–∏—Ç—å Fork —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å –≤–µ—Ç–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ Fork
```

* ‚ùì –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è?

```markdown quiz git_clone_is
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [x] –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–Ω–æ–π –∫–æ–ø–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ –¥—Ä—É–≥–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
- [ ] –§–∏–∫—Å–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Ä–∞–±–æ—á–µ–π –≤–µ—Ç–∫–∏
```

***

## +2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ Docker Hub

- [x] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Å—è –Ω–∞ https://hub.docker.com/
- [x] –ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è —á–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª:

```bash
docker login --username {qwerty}
```

‚ùó `{qwerty}` ‚Äî —Ç–≤–æ–π –ª–æ–≥–∏–Ω –Ω–∞ Docker Hub.

```json how-to
{
  "video": "assets/deploy_conduit/docker_login.webm",
  "width": 796,
  "height": 255
}
```

***

‚ùì –ß—Ç–æ —Ä–∞–∑–º–µ—â–∞—é—Ç –Ω–∞ Docker Hub?

```markdown quiz why_docker_hub
- [ ] Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- [x] Docker-–æ–±—Ä–∞–∑—ã
- [ ] –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã
- [ ] –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

‚ùì Docker Hub —è–≤–ª—è–µ—Ç—Å—è?

```markdown quiz docker_hub_is
- [ ] –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- [ ] –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤
- [x] –û–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –¥–ª—è –æ–±–º–µ–Ω–∞ Docker-–æ–±—Ä–∞–∑–∞–º–∏
- [ ] –°–µ—Ä–≤–∏—Å–æ–º –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
```

‚ùì –ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å –ø–æ–º–æ—â—å—é Docker Hub?

```markdown quiz what_can_do_docker_hub
- [x] –°–∫–∞—á–∏–≤–∞—Ç—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ Docker-–æ–±—Ä–∞–∑—ã
- [ ] –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Docker
- [x] –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ Docker-–æ–±—Ä–∞–∑—ã
- [ ] –ü—Ä–æ–≤–æ–¥–∏—Ç—å —Å–µ—Ç–µ–≤–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏–∑ —Ç—Ä–∞—Ñ–∏–∫–∞
```

‚ùì –ö–∞–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç Docker Hub?

```markdown quiz docker_hub_benefits
- [x] –£–ø—Ä–æ—â–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- [x] –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- [x] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- [x] –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ IT-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
```

‚ùì –î–ª—è —á–µ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è?

```markdown quiz why_login_on_docker_hub
- [ ] –ß—Ç–æ –±—ã —Å–∫–∞—á–∏–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ –æ–±—Ä–∞–∑—ã
- [x] –ß—Ç–æ –±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–æ–∏ –æ–±—Ä–∞–∑—ã
- [ ] –ß—Ç–æ –±—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ Docker-–æ–±—Ä–∞–∑—ã —É –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –ß—Ç–æ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥–∏ –æ–±—Ä–∞–∑–æ–≤
```

***

## +3. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç –ª–æ–∫–∞–ª—å–Ω–æ

### 3.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–µ–∫–µ–Ω–¥–∞

- [x] –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `backend/config/config.js`

```diff
    production: {
      username: process.env.PG_USER,
-     password: process.env.PG_PASSWORD,
+     password: require("fs").readFileSync(process.env.PG_PASSWORD_FILE, "utf8"),
      database: process.env.PG_DATABASE,
      host: process.env.PG_HOST,
      dialect: "postgres",
-     dialectOptions: {
-       ssl: {
-         require: true,
-         rejectUnauthorized: false,
-       },
      },
    },
```

* ‚ùì –ó–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞—é—Ç —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?
* ‚ùì –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ø–∞—Ä–æ–ª—å –¥–ª—è Postgres?
* ‚ùì –ó–∞—á–µ–º –º—ã —É–¥–∞–ª—è–µ–º —Ä–∞–∑–¥–µ–ª `ssl`?
* ‚ùì –ó–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞—é—Ç —Ä–∞–∑–¥–µ–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `development`, `test` –∏ `production`?

***

### 3.2. –°–æ–±–∏—Ä–∞–µ–º Docker –æ–±—Ä–∞–∑

- [x] –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `Dockerfile`

```text
FROM node:16
ARG node_env
ENV NODE_ENV=$node_env \
    PORT=80
WORKDIR /app
COPY ./ ./
RUN npm ci --only=production
RUN npm -w frontend run build
EXPOSE 80
CMD npm run start -w backend
```

* ‚ùì –ù–∞ –∫–∞–∫–æ–º –ø–æ—Ä—Ç—É –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –±–µ–∫–µ–Ω–¥ <md-placeholder value="80"></md-placeholder> ?
* ‚ùì –ó–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç —Ñ–ª–∞–≥ `--only=production`?
* ‚ùì –ö–∞–∫–æ–π –∫–æ–º–∞–Ω–¥–æ–π –º—ã —Å–æ–±–∏—Ä–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ <md-placeholder value="npm -w frontend run build"></md-placeholder> ?

- [x] –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.dockerignore`

```text
node_modules
```

‚ùì –ó–∞—á–µ–º Docker —á—Ç–æ-—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å?

- [x] –°–æ–±–µ—Ä–∏ –æ–±—Ä–∞–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
docker build --build-arg node_evn=production --tag {qwerty}/conduit:1.0.0 .
```

‚ùó `{qwerty}` ‚Äî —Ç–≤–æ–π –ª–æ–≥–∏–Ω –Ω–∞ Docker Hub.

- [x] –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–Ω –∏ –∑–∞—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω —Å –≤–µ—Ä—Å–∏–µ–π `1.0.0`

```bash
docker images
```

```json how-to
{
  "video": "assets/deploy_conduit/build_image.webm",
  "width": 990,
  "height": 300
}
```

* ‚ùì –ß—Ç–æ –∑–Ω–∞—á–∏—Ç —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞?
* ‚ùì –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã?
* ‚ùì –ó–∞—á–µ–º –Ω—É–∂–µ–Ω —Ç–µ–≥ —É –æ–±—Ä–∞–∑–∞?

***

## +4. Docker –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è

- [x] –ê–∫—Ç–∏–≤–∏—Ä—É–π –≤ Docker **—Ä–µ–∂–∏–º —Ä–æ—è:**

```bash
docker swarm init
```

‚ùì –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ–∂–∏–º —Ä–æ—è –≤ Docker?

```markdown quiz docker_hub_benefits
- [ ] –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
- [x] –†–µ–∂–∏–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- [ ] –†–µ–∂–∏–º —É–ø—Ä–æ—â–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- [ ] –†–µ–∂–∏–º –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤
```

* ‚ùì –ß—Ç–æ –∑–Ω–∞—á–∏—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è?
* ‚ùì –ß–µ–º –¥–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ?

- [x] –°–æ–∑–¥–∞–π —Å–µ–∫—Ä–µ—Ç—ã –ø–æ—à–∞–≥–æ–≤–æ:

```bash
echo "xxxYYY" | docker secret create db_root_password -
echo "yyyZZZ" | docker secret create db_password -
```

- [x] –ü—Ä–æ–≤–µ—Ä—å —Å–µ–∫—Ä–µ—Ç—ã –ø–æ—à–∞–≥–æ–≤–æ:

```bash
docker secret ls
docker secret inspect db_root_password
docker secret inspect db_password
```

‚ùì –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö?

- [x] –°–æ–∑–¥–∞–π –≤–æ–ª—å—é–º—ã –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã:

```bash
docker volume create pg_data
```

- [x] –ü—Ä–æ–≤–µ—Ä—å –≤–æ–ª—å—é–º—ã:

```bash
docker volume ls
docker volume inspect pg_data
```

‚ùì –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –≤–æ–ª—å—é–º–∞—Ö –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?

- [x] –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `deploy.yml`

```yaml
version: "3.9"

secrets:
  db_root_password:
    external: true
  db_password:
    external: true

volumes:
  pg_data:
    external: true

services:
  postgres:
    image: postgres:15.2-bullseye
    secrets:
      - db_root_password
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/db_root_password
    volumes:
      - pg_data:/var/lib/postgresql/data
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres" ]
      interval: 10s
      retries: 15
      start_period: 2s
      timeout: 10s

  conduit:
    image: {qwerty}/conduit:${VERSION}
    links:
      - "postgres:postgres"
    ports:
      - 80:80
    depends_on:
      - postgres
    secrets:
      - db_password
    environment:
      NODE_ENV: production
      JWT_KEY: secret
      PG_HOST: postgres
      PG_USER: conduit
      PG_PASSWORD_FILE: /run/secrets/db_password
      PG_DATABASE: conduit
    healthcheck:
      test: curl --fail http://localhost || exit 1
      interval: 10s
      retries: 15
      start_period: 2s
      timeout: 10s
```

- [x] ‚ùó –ó–∞–º–µ–Ω–∏ –≤ —Ñ–∞–π–ª–µ `{qwerty}` –Ω–∞ —Ç–≤–æ–π –ª–æ–≥–∏–Ω –Ω–∞ Docker Hub.
- [x] –°–¥–µ–ª–∞–π –¥–µ–ø–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Å—Ç–µ–∫–µ:

```bash
VERSION=1.0.0 docker stack deploy --compose-file deploy.yml app_blogs
```

- [x] –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Å—Ç–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω:

```bash
docker stack ls
```

- [x] –ü—Ä–æ–≤–µ—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Å—Ç–µ–∫–µ:

```bash
docker stack services app_blogs
```

- [x] –ü—Ä–æ–≤–µ—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ Postgres:

```bash
docker service ps app_blogs_postgres
docker service logs app_blogs_postgres
```

- [x] –ü—Ä–æ–≤–µ—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞ Conduit:

```bash
docker service ps app_blogs_conduit
docker service logs app_blogs_conduit
```

- [x] –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ http://localhost

***

## +5. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- [x] –ù–∞–π–¥–∏ ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è Postgres:

```bash
docker ps --format '{{.Names}}'
```

```text
app_postgres.1.xyz
```

- [x] –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –∫–æ–Ω—Å–æ–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å Postgres:

```bash
docker exec -it app_blogs_postgres.1.{xyz} /bin/bash
```

‚ùó `{xyz}` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.

- [x] –ü–µ—Ä–µ–∫–ª—é—á–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
su postgres
```

- [x] –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –°–£–ë–î —á–µ—Ä–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º—É –∫–ª–∏–µ–Ω—Ç:

```bash
psql
```

- [x] –°–æ–∑–¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `conduit`

```bash
create user conduit with password 'yyyZZZ';
```

- [x] –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—è–≤–∏–ª—Å—è:

```bash
\du
```

- [x] –°–æ–∑–¥–∞–π –±–∞–∑—É —Å –∏–º–µ–Ω–µ–º `conduit`

```bash
create database conduit;
```

- [x] –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –±–∞–∑–∞ —Å–æ–∑–¥–∞–Ω–∞:

```bash
\l
```

- [x] –ù–∞–∑–Ω–∞—á—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –±–∞–∑—ã –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
alter database conduit owner to conduit;
```

- [x] –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤–ª–∞–¥–µ–ª–µ—Ü –Ω–∞–∑–Ω–∞—á–µ–Ω:

```bash
\l
```

- [x] –û—Ç–∫–ª—é—á–∏—Å—å –æ—Ç –°–£–ë–î:

```bash
\q
```

- [x] –ü—Ä–æ–≤–µ—Ä—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
psql -h localhost -d conduit -U conduit -W
```

‚ùó –í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å `yyyZZZ`

- [x] –í—ã–π–¥–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
exit
exit
```

## +6. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã

- [x] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å Conduit:

```bash
docker service update app_blogs_conduit --force
```

- [x] –ù–∞–π–¥–∏ ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–ª—è Conduit:

```bash
docker ps --format '{{.Names}}'
```

- [x] –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –∫–æ–Ω—Å–æ–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å Conduit:

```bash
docker exec -it app_blogs_conduit.1.{xyz} /bin/bash
```

‚ùó `{xyz}` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä. 

- [x] –ó–∞–ø–æ–ª–Ω–∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```bash
npx -w backend sequelize-cli db:seed:all
```

- [x] –û—Ç–∫—Ä–æ–π http://localhost/

## +7. –ü—É–±–ª–∏–∫–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–∞

- [x] –°–æ–±–µ—Ä–∏ –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑ `1.0.0-amd64` –ø–æ–¥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–µ—Ä–≤–µ—Ä–∞:

```bash
docker build --platform linux/amd64 -t {qwerty}/conduit:1.0.0-amd64 .
```

- [x] –ü—Ä–æ–≤–µ—Ä—å —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞–∑–æ–≤ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º Docker —Ä–µ–ø–æ–∑–∏—Ç–∞—Ä–∏–∏:

```bash
docker images
```

- [x] –ó–∞–ø—É—à—å –Ω—É–∂–Ω—ã–π –æ–±—Ä–∞–∑:

```bash
docker push {qwerty}/conduit:1.0.0-amd64
```

‚ùó `{qwerty}` ‚Äî —Ç–≤–æ–π –ª–æ–≥–∏–Ω –Ω–∞ Docker Hub.

- [x] –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –æ–±—Ä–∞–∑ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω:

https://hub.docker.com/repository/docker/{qwerty}/conduit/general

## +8. –ü–æ–∫—É–ø–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

- [x] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π –∞–∫–∫–∞—É–Ω—Ç —É —Ö–æ—Å—Ç–∏–Ω–≥ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ [selectel.ru](https://www.selectel.ru)
- [x] –ü–æ–ø–æ–ª–Ω–∏ –±–∞–ª–∞–Ω—Å –Ω–∞ 500 —Ä—É–±.
- [x] –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ Ubuntu:

<img class="cornered" title="–ü–æ–∫—É–ø–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"
    width="782" height="510" src="assets/deploy_conduit/new_server.webp">

- [x] –í—ã–±–µ—Ä–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ä–≤–µ—Ä–∞ 1 vCPU | 1GB RAM | 10 GB SSD:

<img class="cornered" title="?"
    width="622" height="453" src="assets/deploy_conduit/server_cpu_ssd.webp">   

- [x] –ü—Ä–æ–≤–µ—Ä—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ç–∏:

<img class="cornered" title="?"
    width="581" height="388" src="assets/deploy_conduit/server_network.webp"> 

- [x] –°–æ—Ö—Ä–∞–Ω–∏ –ø–∞—Ä–æ–ª—å –æ—Ç **root** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

<img class="cornered" title="?"
    width="333" height="126" src="assets/deploy_conduit/server_ssh.webp">

- [x] –í—ã–±–µ—Ä–∏ –ø–æ—á–∞—Å–æ–≤—É—é –æ–ø–ª–∞—Ç—É –∑–∞ —Å–µ—Ä–≤–µ—Ä:

<img class="cornered" title="?"
    width="913" height="271" src="assets/deploy_conduit/server_cost.webp">

- [x] –î–æ–∂–¥–∏—Å—å —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞:

<img class="cornered" title="?"
    width="919" height="120" src="assets/deploy_conduit/server_ip.webp">

- [x] –í–æ–π–¥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH:

```json how-to
{
  "video": "assets/deploy_conduit/login_on_server.webm",
  "width": 990,
  "height": 334
}
```

- [x] –ü–æ–¥–≥–æ—Ç–æ–≤—å —Å–µ—Ä–≤–µ—Ä:

```bash
apt-get update
apt-get install docker.io
```

## +9. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

- [x] –ê–∫—Ç–∏–≤–∏—Ä—É–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ **—Ä–µ–∂–∏–º —Ä–æ—è** –≤ Docker:

```bash
docker swarm init
```

- [x] –°–æ–∑–¥–∞–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–µ–∫—Ä–µ—Ç—ã –ø–æ—à–∞–≥–æ–≤–æ:

```bash
docker secret ls
echo "xxxYYY" | docker secret create db_root_password -
echo "yyyZZZ" | docker secret create db_password -
```

- [x] –ü—Ä–æ–≤–µ—Ä—å —Å–µ–∫—Ä–µ—Ç—ã –ø–æ—à–∞–≥–æ–≤–æ:

```bash
docker secret ls
docker secret inspect db_root_password
docker secret inspect db_password
```

- [x] –°–æ–∑–¥–∞–π –≤–æ–ª—å—é–º—ã:

```bash
docker volume ls
docker volume create pg_data
```

- [x] –ü—Ä–æ–≤–µ—Ä—å –≤–æ–ª—å—é–º—ã:

```bash
docker volume ls
docker volume inspect pg_data
```

- [x] –£—Å—Ç–∞–Ω–æ–≤–∏ –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π **—Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä Vim:**

```bash
apt-get -qq install vim
```

- [x] –°–∫–æ–ø–∏—Ä—É–π –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ —Ñ–∞–π–ª `deploy.yml` –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞.
- [x] –û—Ç–∫—Ä–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
vi deploy.yml
```

- [x] –ù–∞–∂–º–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

`i` ‚Üí `CTRL` + `V` ‚Üí `ESC` ‚Üí `:w` ‚Üí `:q`

- [x] –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ñ–∞–π–ª –ø–æ—è–≤–∏–ª—Å—è:

```bash
ls -l
```

```json how-to
{
  "video": "assets/deploy_conduit/vi_deploy.webm",
  "width": 990,
  "height": 334
}
```

- [x] –ó–∞–ø—É–ª—å —Å Docker Hub –Ω—É–∂–Ω—ã–π –æ–±—Ä–∞–∑:

```bash
docker pull {qwerty}/conduit:1.0.0-amd64
```

- [x] –í—ã–ø–æ–ª–Ω–∏ –¥–µ–ø–ª–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Å—Ç–µ–∫–µ `app_blogs`

```bash
VERSION=1.0.0-amd64 docker stack deploy --compose-file deploy.yml app_blogs
```

- [x] –°–æ–∑–¥–∞–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—à–∞–≥–æ–≤–æ:

```bash
docker exec -it app_blogs_postgres.1.{xyz} /bin/bash
su postgres
psql
create user conduit with password 'yyyZZZ';
\du
create database conduit;
\l
alter database conduit owner to conduit;
\l
\q
exit
exit
```

- [x] –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å `conduit` –≤ —Å—Ç–µ–∫–µ `app_blogs`

```bash
docker service update app_blogs_conduit --force
npx -w backend sequelize-cli db:seed:all
```

- [x] –û—Ç–∫—Ä–æ–π `http://{external_ip}/`

# üò≠ –î–æ–º–∞—à–∫–∞

- [ ] –ò–∑—É—á–∏ –µ—â–µ –ø–æ–ª–µ–∑–Ω—ã–µ Docker –∫–æ–º–∞–Ω–¥—ã:

```bash
docker ps
docker stack ls
docker stack rm
docker rmi --force
docker volume rm
docker secret rm
docker system prune --all
```

# üôè –§–∏–¥–±–µ–∫ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞

<import from="/partials/tutorial_feedback.md"></import>